name: Sync Release and Deploy to Frontend

on:
  release:
    types: [created, published, edited]
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  sync-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Sync to Frontend Repo
        env:
          GH_TOKEN: ${{ secrets.RELEASE_SYNC_PAT }}
          TARGET_REPO: "gl33332/Sanyue-ImgHub"
        run: |
          echo "Triggering sync to $TARGET_REPO..."
          # 这里的逻辑是直接通过 GitHub CLI 触发目标仓库的 Action 或更新文件
          # 如果你只是想在 push 时也同步 Release，可以保留原来的 gh release 逻辑
          # 如果目标是让博客更新，通常是触发目标仓库的 repository_dispatch
          
          curl -X POST -H "Authorization: token $GH_TOKEN" \
               -H "Accept: application/vnd.github.v3+json" \
               https://api.github.com/repos/$TARGET_REPO/dispatches \
               -d '{"event_type": "webhook_update"}'
          
          echo "Successfully dispatched update signal to $TARGET_REPO."
